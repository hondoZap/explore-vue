version: "3.4"

x-base-build: &base-build
  context: .
  args:
    - DOCKER_REGISTRY
    - VERSION

services:
  template-web:
    build: *base-build
  tests:
    build:
      <<: *base-build
      target: api
    command: bash -c 'trap "chmod 777 -R TestResults" EXIT; dotnet test --no-restore --no-build'
    volumes:
      - ./api/TestResults:/src/TestResults
